<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nome do Projeto - Portfolio DreamArq</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.jpg">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.jpg">
    <link rel="apple-touch-icon" href="/images/favicon.jpg">
    <link rel="shortcut icon" href="/images/favicon.jpg">

    <link rel="stylesheet" href="../../css/styles.css">
    <link rel="stylesheet" href="../../css/project-detail.css">
    <link rel="stylesheet" href="../../css/image-loading.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <a href="../..">
                    <img src="../../images/logo_black_letters.png" alt="DreamArq Logo">
                </a>
            </div>
            <ul class="nav-links">
                <li><a href="../../#about">Quem Somos</a></li>
                <li><a href="../../#projects">Projetos</a></li>
                <li><a href="../../#services">Serviços</a></li>
                <li><a href="../../#contact">Contactos</a></li>
            </ul>
            <div class="burger">
                <div class="line1"></div>
                <div class="line2"></div>
                <div class="line3"></div>
            </div>
        </nav>
    </header>

    <main class="project-detail">
        <div class="container">
            <div class="back-link">
                <a href="../../#projects"><i class="fas fa-arrow-left"></i> Voltar aos Projetos</a>
            </div>
            
            <div id="project-content">
                <!-- Este conteúdo será preenchido dinamicamente pelo JavaScript -->
                <div class="loading">Carregando detalhes do projeto...</div>
            </div>
        </div>
    </main>

    <!-- Image Modal -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <img id="modalImage" src="" alt="">
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="../../images/logo_white_letters.png" alt="DreamArq Logo">
                </div>
                <div class="footer-links">
                    <h3>Links Rápidos</h3>
                    <ul>
                        <li><a href="../../#about">Quem Somos</a></li>
                        <li><a href="../../#projects">Projetos</a></li>
                        <li><a href="../../#services">Serviços</a></li>
                        <li><a href="../../#contact">Contactos</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h3>Entre em Contato</h3>
                    <p><i class="fas fa-phone"></i> +351 960 366 965</p>
                    <p><i class="fas fa-envelope"></i> geraldreamarq@gmail.com</p>
                    <div class="social-links">
                        <a href="https://www.facebook.com/share/1ArvnAvVFC/" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://www.instagram.com/dreamarq.arquitetura?igsh=MTBrYzdjNHVlZGRrbQ==" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="https://www.linkedin.com/company/dream-arquitetura" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.tiktok.com/@dream.arq4?_t=ZG-8ySur46wOQa&_r=1" aria-label="TikTok"><i class="fab fa-tiktok"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 DreamArq. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="../../js/script.js"></script>
    <script>
        // Enhanced performance enhancement functions fallback
        function handleImageLoad(img) {
            const container = img.parentNode;
            const carouselSlide = img.closest('.carousel-slide');
            
            // Add a small delay for smoother transition
            setTimeout(() => {
                container.classList.replace('image-loading', 'image-loaded');
                img.classList.add('loaded');
                
                // If it's in a carousel, adjust height
                if (carouselSlide && window.innerWidth <= 767) {
                    adjustCarouselHeight(carouselSlide);
                }
            }, 100);
        }
        
        function handleImageError(img) {
            const container = img.parentNode;
            container.classList.remove('image-loading');
            container.classList.add('image-error');
            
            // Set a fallback background
            img.style.background = '#f0f0f0';
            img.style.display = 'none';
            
            // Add error indicator
            if (!container.querySelector('.error-indicator')) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-indicator';
                errorDiv.innerHTML = '<i class="fas fa-image"></i><p>Imagem não disponível</p>';
                errorDiv.style.cssText = `
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    height: 100%;
                    color: #999;
                    background: #f9f9f9;
                `;
                container.appendChild(errorDiv);
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Get the project directory name from the URL path
            const pathParts = window.location.pathname.split('/');
            const projectDir = pathParts[pathParts.indexOf('projects') + 1];
            
            if (!projectDir) {
                showError('Projeto não encontrado');
                return;
            }
            
            // Get base URL for GitHub Pages compatibility
            const baseUrl = getBaseUrl();
            
            // Load project data from JSON file
            fetch(`${baseUrl}/projects/${projectDir}/project.json`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Dados do projeto não encontrados');
                    }
                    return response.json();
                })
                .then(projectData => {
                    displayProjectDetails(projectDir, projectData);
                    // Update page title
                    document.title = `${projectData.name} - Portfolio DreamArq`;
                })
                .catch(error => {
                    console.error('Erro ao carregar detalhes do projeto:', error);
                    showError('Não foi possível carregar os detalhes do projeto. Tente novamente mais tarde.');
                });
        });
        
        function displayProjectDetails(projectDir, data) {
            const projectContent = document.getElementById('project-content');
            // Make sure baseUrl is accessible within this function
            const baseUrl = getBaseUrl();
            
            // Create HTML content for project details
            let html = `
                <h1 class="project-title">${data.name}</h1>
                <div class="project-category">${getCategoryLabel(data.category)}</div>
                
                <div class="project-gallery">
                    <div class="carousel-container">
                        <div class="carousel-wrapper">
                            <div class="carousel-slides" id="carousel-slides">
                                ${data.images.map((image, index) => `
                                    <div class="carousel-slide${index === 0 ? ' active' : ''}">
                                        <div class="image-container image-loading">
                                            <img src="${baseUrl}/projects/${projectDir}/${image.path}" alt="${image.caption}"
                                                ${index > 0 ? 'loading="lazy"' : ''}
                                                onload="handleImageLoad ? handleImageLoad(this) : this.parentNode.classList.replace('image-loading', 'image-loaded')"
                                                onerror="handleImageError ? handleImageError(this) : console.error('Image failed to load')"
                                                onclick="openModalFromCarousel()"
                                                style="cursor: pointer;"
                                                title="Clique para ampliar">
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <button class="carousel-btn carousel-prev" onclick="changeSlide(-1)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="carousel-btn carousel-next" onclick="changeSlide(1)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        
                        <div class="carousel-indicators">
                            ${data.images.map((_, index) => `
                                <span class="indicator${index === 0 ? ' active' : ''}" onclick="currentSlide(${index + 1})"></span>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <div class="project-info-grid">
                    <div class="project-description">
                        <h2>Sobre este Projeto</h2>
                        <p>${data.description}</p>
                    </div>
                    
                    <div class="project-details">
                        <h2>Detalhes do Projeto</h2>
                        <ul>
                            ${generateDetailsListItems(data.details)}
                        </ul>
                    </div>
                </div>
            `;
            
            projectContent.innerHTML = html;
            
            // Initialize carousel with performance enhancements
            initializeCarousel();
            
            // Add progressive loading animations
            const projectElements = projectContent.querySelectorAll('.project-title, .project-category, .carousel-container, .project-info-grid');
            projectElements.forEach((element, index) => {
                element.style.opacity = '0';
                element.style.transform = 'translateY(20px)';
                element.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                element.style.animationDelay = `${index * 0.1}s`;
                
                setTimeout(() => {
                    element.style.opacity = '1';
                    element.style.transform = 'translateY(0)';
                }, 100 + (index * 100));
            });
            
            // Initialize intersection observer for project elements
            if (typeof observeElement === 'function') {
                projectElements.forEach(element => {
                    observeElement(element);
                });
            }
        }
        
        // Carousel functionality
        let slideIndex = 1;
        
        function initializeCarousel() {
            showSlide(slideIndex);
        }
        
        function changeSlide(n) {
            const slides = document.querySelectorAll('.carousel-slide');
            slideIndex += n;
            
            if (slideIndex > slides.length) {
                slideIndex = 1;
            }
            if (slideIndex < 1) {
                slideIndex = slides.length;
            }
            
            showSlide(slideIndex);
        }
        
        function currentSlide(n) {
            slideIndex = n;
            showSlide(slideIndex);
        }
        
        function showSlide(n) {
            const slides = document.querySelectorAll('.carousel-slide');
            const indicators = document.querySelectorAll('.indicator');
            
            // Hide all slides
            slides.forEach(slide => {
                slide.classList.remove('active');
            });
            
            // Remove active class from all indicators
            indicators.forEach(indicator => {
                indicator.classList.remove('active');
            });
            
            // Show current slide and activate indicator
            if (slides[n - 1]) {
                slides[n - 1].classList.add('active');
                
                // Lazy load current slide image if not already loaded
                const currentImg = slides[n - 1].querySelector('img');
                if (currentImg && !currentImg.src && currentImg.dataset.src) {
                    currentImg.src = currentImg.dataset.src;
                }
                
                // Preload next and previous slides for smooth navigation
                const nextIndex = n < slides.length ? n : 0;
                const prevIndex = n > 1 ? n - 2 : slides.length - 1;
                
                [nextIndex, prevIndex].forEach(index => {
                    if (slides[index]) {
                        const img = slides[index].querySelector('img');
                        if (img && !img.src && img.dataset.src) {
                            img.src = img.dataset.src;
                        }
                    }
                });
            }
            
            if (indicators[n - 1]) {
                indicators[n - 1].classList.add('active');
            }
        }
        
        // Auto-play carousel (optional)
        function startAutoPlay() {
            setInterval(() => {
                changeSlide(1);
            }, 5000); // Change slide every 5 seconds
        }
        
        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft') {
                changeSlide(-1);
            } else if (e.key === 'ArrowRight') {
                changeSlide(1);
            }
        });
        
        function generateDetailsListItems(details) {
            if (!details) return '';
            
            // Define display labels for keys
            const detailsLabels = {
                'location': 'Localização',
                'status': 'Estado',
                'type': 'Tipo',
                'style': 'Estilo',
                'year': 'Ano',
                'area': 'Área',
                'client': 'Cliente',
                'architect': 'Arquiteto',
                'budget': 'Orçamento'
                // Add any other fields you might use
            };
            
            // Generate list items for each detail that exists
            let listItems = '';
            for (const key in details) {
                if (details[key]) { // Only include if value exists
                    const label = detailsLabels[key] || key.charAt(0).toUpperCase() + key.slice(1);
                    listItems += `<li><strong>${label}:</strong> ${details[key]}</li>\n                            `;
                }
            }
            
            return listItems;
        }
        
        function getCategoryLabel(category) {
            const categories = {
                'residential': 'Projeto Residencial',
                'commercial': 'Projeto Comercial',
                'public': 'Projeto Público',
                'mixed': 'Projeto de Uso Misto'
            };
            
            return categories[category] || 'Projeto';
        }
        
        function showError(message) {
            const projectContent = document.getElementById('project-content');
            const baseUrl = getBaseUrl();
            projectContent.innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>${message}</p>
                    <a href="${baseUrl}/index.html#projects" class="btn-small">Voltar aos Projetos</a>
                </div>
            `;
        }
        
        // Modal functionality
        function openModal(imageSrc) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            
            modal.style.display = 'block';
            modalImg.src = imageSrc;
            
            // Prevent body scrolling when modal is open
            document.body.style.overflow = 'hidden';
        }
        
        // Open modal with currently active carousel image
        function openModalFromCarousel() {
            const activeSlide = document.querySelector('.carousel-slide.active');
            if (activeSlide) {
                const activeImg = activeSlide.querySelector('img');
                if (activeImg && activeImg.src) {
                    openModal(activeImg.src);
                }
            }
        }
        
        function closeModal() {
            const modal = document.getElementById('imageModal');
            modal.style.display = 'none';
            
            // Restore body scrolling
            document.body.style.overflow = 'auto';
        }
        
        // Close modal when clicking the X button
        document.addEventListener('DOMContentLoaded', function() {
            const closeBtn = document.querySelector('.close-modal');
            if (closeBtn) {
                closeBtn.addEventListener('click', closeModal);
            }
            
            // Close modal when clicking outside the image
            const modal = document.getElementById('imageModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeModal();
                    }
                });
            }
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                }
            });
        });
        
        // Function to determine the base URL (for GitHub Pages compatibility)
        function getBaseUrl() {
            // Check if we're on GitHub Pages
            const repoName = 'DreamArq-Web-Portfolio';
            const currentUrl = window.location.href;
            
            if (currentUrl.includes('github.io')) {
                // We're on GitHub Pages, return the repository path
                return `/${repoName}`;
            }
            
            // We're on local development or custom domain
            return '';
        }
    </script>
</body>
</html>
